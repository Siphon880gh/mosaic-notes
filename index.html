<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mosaic Notes</title>
    <link rel="stylesheet" href="https://api.jqueryui.com/jquery-wp-content/themes/jquery/css/base.css?v=4"></link>
    <link rel="stylesheet" href="bower_components/font-awesome/css/all.min.css"></link>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css"></link>
    <link rel="stylesheet" href="bower_components/medium-editor/dist/css/medium-editor.min.css">
    <link rel="stylesheet" href="assets/themes/medium-editor/flat.plain.min.css">
    <link rel="stylesheet" href="assets/themes/tailwindcss/unreset.css">
    <link rel="stylesheet" href="assets/index.css"></link>

    <style id="dynamic-style-block--gap">
        .grid {
            gap: 3px;
        }
    </style>
    <style id="dynamic-style-block--padding">
        .grid-item {
            padding: 10px;
        }
    </style>

    <script>
        /**
         * 
         * function changeBoxMode
         * @param {string} mode resizable|rearrange|plain  
         * 
         */
        function changeBoxMode(mode) {

            switch (mode) {
                case "resizable":
                    $("#box-mode").html(
                        `
                            .handle-rearrange {
                                display: none !important;
                            }

                            .ui-resizable-e,
                            .ui-resizable-s,
                            .ui-resizable-se {
                                display: auto !important;
                            }
                        `
                    )
                    break;
                case "rearrange":
                    $("#box-mode").html(
                        `
                            .handle-rearrange {
                                display: auto !important;
                            }

                            .ui-resizable-e,
                            .ui-resizable-s,
                            .ui-resizable-se {
                                display: none !important;
                            }
                        `
                    )
                    break;
                case "plain":
                    $("#box-mode").html(
                        `
                            .handle-rearrange {
                                display: none !important;
                            }

                            .ui-resizable-e,
                            .ui-resizable-s,
                            .ui-resizable-se {
                                display: none !important;
                            }
                        `
                    )
                    break;
                default:
            }

        } // changeBoxMode


        function enableSort() {
            $(".grid").sortable({
                items: "> .grid-item",
                cursor: "move",
                handle: ".handle-rearrange",
                helper: "clone",
                revert: true,
                scroll: true,
                // tolerance: "pointer",
                forceHelperSize: true,
                forcePlaceholderSize: true,
                sort(event, ui) {
                    const w = ui.helper.width(),
                        h = ui.helper.height();

                    ui.placeholder.css("visibility", "visible");
                    ui.placeholder.css("height", h);
                    ui.placeholder.css("width", w);
                    ui.placeholder.css("background-color", "lightred");
                }
            });
        }

        function disableSort() {
            $(".grid").sortable("destroy");
            // $(".grid-item").sortable();
        }
    </script>
    <style id="box-mode">
        .handle-rearrange {
            display: none !important;
        }
        
        .ui-resizable-e,
        .ui-resizable-s,
        .ui-resizable-se {
            display: none !important;
        }
    </style>
</head>

<body>
    <main class="grid">
        <div class="grid-item rounded-sm unreset" contenteditable="true" style="width:33%">
            <b>Mosaic Notes</b>
            <span>By Weng Fei Fung.</span>
            <p>Create boxes stacked in a mosaic way for you to customize with instructions, then print it out for traditional pencil and pen notetaking. You can resize these boxes, add rich text, even paste pictures into it. In the end, print for your note
                taking purposes at school, work, etc. An example use is nursing brainsheets.</p>
            <span class="handle-rearrange ui-icon ui-icon-arrow-4-diag"></span>
        </div>
        <div class="grid-item rounded-sm unreset" contenteditable="true" style="width:33%">
            <p>This is a sample box. Create more mosaic boxes from <i class="fa fa-cog"></i>, resize this one, add content, paste pictures! Toggle on borders for specific boxes. Hide italic texts. Adjust the overall spacing. Design your mosaic notes now!</p>
            <span class="handle-rearrange ui-icon ui-icon-arrow-4-diag"></span>
        </div>
    </main>
    <nav class="page-controls w-108 text-right">

        <i class="fa fa-solid fa-gear cursor-pointer" onclick="toggleClass('.page-controls__controls', 'invisible')"></i>
        <ul class="page-controls__controls invisible bg-gray-200 rounded-md p-2 text-left opacity-75">
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="addBox()">
                <i class="fa fa-vector-square"></i> New
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="precheckCanDuplicateBox()">
                <i class="fa fa-clone"></i> Duplicate
            </li>
            <li class="mb-2">
                <hr style="border-color:gray" />
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="deleteLastBox()">
                <i class="fa fa-times-circle"></i> Delete box
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="clearCanvas()">
                <i class="fa fa-trash-alt"></i> Clear Canvas
            </li>
            <li class="mb-2">
                <hr style="border-color:gray" />
            </li>
            <li class="text-center">
                <label for="gap"><i class="fa fa-wave-square"></i> Gap px:</label><br/>
                <input id="gap" class="w-12 border-1 ring-1 border-black ring-black rounded-sm p-1 mt-1 mb-2" min="0" value="3" type="number" onchange="changeGap('.grid', $(this).val()+'px')">
            </li>
            <li class="text-center">
                <label for="padding"><i class="fa fa-compress-arrows-alt"></i> Padding px:</label><br/>
                <input id="padding" class="w-12 border-1 ring-1 border-black ring-black rounded-sm p-1 mt-1 mb-2" min="0" value="10" type="number" onchange="changePadding('.grid-item', $(this).val()+'px')">
            </li>
            <li class="mb-2">
                <hr style="border-color:gray" />
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="toggleLastBoxBorders();">
                <i class="fa-regular fa-square"></i> Toggle Border
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="changeBorderLength();">
                <i class="fa-regular fa-square"></i> Border Length
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer">
                <i class="fa-regular fa-square"></i> Border Color
                <input type="color" id="change-border-color" onchange="changeBorderColor(event);" style="width:25px; height:25px; vertical-align:middle;">
            </li>
            <li class="mb-2">
                <hr style="border-color:gray" />
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="toggleClass('i:not(.fa)', 'hidden'); $(this).toggleClass('active');">
                <i class="fa fa-print"></i> Collapse italics
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="toggleClass('i:not(.fa)', 'invisible'); $(this).toggleClass('active');">
                <i class="fa fa-print"></i> Invisible italics
            </li>
            <li class="mb-2 hover:text-red-900 cursor-pointer" onclick="window.print()">
                <i class="fa fa-print"></i> Print
            </li>
        </ul>
    </nav>

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="bower_components/medium-editor/dist/js/medium-editor.min.js"></script>
    <script src="assets/themes/medium-editor/flat.plain.icons.min.js"></script>
    <script src="assets/index.js"></script>
    <script src="assets/persist.js"></script>

    <script>
        $(() => {
            enableSort();
        })
    </script>
    <script>
        document.body.addEventListener('keydown', function(e) {
            // console.log(e.shiftKey); // shift
            // console.log(e.ctrlKey); // ctrl
            // console.log(e.altKey); // alt
            // console.log(e.metaKey); // command/windows (meta) key
            if ((e.metaKey || e.ctrlKey) && e.shiftKey)
                changeBoxMode("rearrange")
            else if ((e.metaKey || e.ctrlKey) && !e.shiftKey)
                changeBoxMode("resizable")
            else if (!e.metaKey && !e.ctrlKey && !e.shiftKey)
                changeBoxMode("plain")
        });
        document.body.addEventListener('keyup', function(e) {
            changeBoxMode("plain")
        });
    </script>
</body>

</html>